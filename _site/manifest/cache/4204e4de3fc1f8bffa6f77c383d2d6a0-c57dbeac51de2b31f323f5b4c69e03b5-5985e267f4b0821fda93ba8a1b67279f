<pre><line id="1"><marker></marker><content><span class="context-markup xml xsl"><span class="declaration open close"><span class="begin">&lt;?xml</span> <span class="attribute">version=</span><span class="value">"1.0"</span> <span class="attribute">encoding=</span><span class="value">"utf-8"</span><span class="end">?&gt;</span></span><span class="text"></content></line></span></span>
<line id="2"><marker></marker><content><span class="context-markup xml xsl"><span class="text"></span><span class="tag open"><span class="begin">&lt;xsl:stylesheet</span> <span class="attribute">version=</span><span class="value">"1.0"</span></content></line></span></span>
<line id="3"><marker></marker><content><span class="context-markup xml xsl"><span class="tag open">    <span class="attribute">xmlns:xsl=</span><span class="value">"http://www.w3.org/1999/XSL/Transform"</span></content></line></span></span>
<line id="4"><marker></marker><content><span class="context-markup xml xsl"><span class="tag open">    <span class="attribute">xmlns:exsl=</span><span class="value">"http://exslt.org/common"</span></content></line></span></span>
<line id="5"><marker></marker><content><span class="context-markup xml xsl"><span class="tag open">    <span class="attribute">extension-element-prefixes=</span><span class="value">"exsl"</span><span class="end">&gt;</span></span><span class="text"></content></line></span></span>
<line id="6"><marker></marker><content><span class="context-markup xml xsl"><span class="text"></content></line></span></span>
<line id="7"><marker></marker><content><span class="context-markup xml xsl"><span class="text"></span><span class="tag open"><span class="begin">&lt;xsl:import</span> <span class="attribute">href=</span><span class="value">"string-replace.xsl"</span> <span class="end">/&gt;</span></span><span class="text"></content></line></span></span>
<line id="8"><marker></marker><content><span class="context-markup xml xsl"><span class="text"></content></line></span></span>
<line id="9"><marker></marker><content><span class="context-markup xml xsl"><span class="text"></span><span class="tag open"><span class="begin">&lt;xsl:strip-space</span> <span class="attribute">elements=</span><span class="value">"*"</span><span class="end">/&gt;</span></span><span class="text"></content></line></span></span>
<line id="10"><marker></marker><content><span class="context-markup xml xsl"><span class="text"></content></line></span></span>
<line id="11"><marker></marker><content><span class="context-markup xml xsl"><span class="text"></span><span class="comment"><span class="start">&lt;!--</span></content></line></span></span>
<line id="12"><marker></marker><content><span class="context-markup xml xsl"><span class="comment">Example call</content></line></span></span>
<line id="13"><marker></marker><content><span class="context-markup xml xsl"><span class="comment"></content></line></span></span>
<line id="14"><marker></marker><content><span class="context-markup xml xsl"><span class="comment">    &lt;xsl:call-template name="json"&gt;</content></line></span></span>
<line id="15"><marker></marker><content><span class="context-markup xml xsl"><span class="comment">        &lt;xsl:with-param name="xml"&gt;</content></line></span></span>
<line id="16"><marker></marker><content><span class="context-markup xml xsl"><span class="comment">            [Any XSLT-transformation]</content></line></span></span>
<line id="17"><marker></marker><content><span class="context-markup xml xsl"><span class="comment">        &lt;/xsl:with-param&gt;</content></line></span></span>
<line id="18"><marker></marker><content><span class="context-markup xml xsl"><span class="comment">    &lt;/xsl:call-template&gt;</content></line></span></span>
<line id="19"><marker></marker><content><span class="context-markup xml xsl"><span class="comment"><span class="stop">--&gt;</span></span><span class="text"></content></line></span></span>
<line id="20"><marker></marker><content><span class="context-markup xml xsl"><span class="text"></content></line></span></span>
<line id="21"><marker></marker><content><span class="context-markup xml xsl"><span class="text">    </span><span class="tag open"><span class="begin">&lt;xsl:template</span> <span class="attribute">name=</span><span class="value">"json"</span><span class="end">&gt;</span></span><span class="text"></content></line></span></span>
<line id="22"><marker></marker><content><span class="context-markup xml xsl"><span class="text">        </span><span class="tag open"><span class="begin">&lt;xsl:param</span> <span class="attribute">name=</span><span class="value">"xml"</span> <span class="end">/&gt;</span></span><span class="text"></content></line></span></span>
<line id="23"><marker></marker><content><span class="context-markup xml xsl"><span class="text">        {</span><span class="tag open"><span class="begin">&lt;xsl:apply-templates</span> <span class="attribute">select=</span><span class="value xpath">"exsl:node-set($xml)"</span> <span class="attribute">mode=</span><span class="value">"json"</span> <span class="end">/&gt;</span></span><span class="text">}</content></line></span></span>
<line id="24"><marker></marker><content><span class="context-markup xml xsl"><span class="text">    </span><span class="tag close">&lt;/xsl:template&gt;</span><span class="text"></content></line></span></span>
<line id="25"><marker></marker><content><span class="context-markup xml xsl"><span class="text"></content></line></span></span>
<line id="26"><marker></marker><content><span class="context-markup xml xsl"><span class="text">    </span><span class="tag open"><span class="begin">&lt;xsl:template</span> <span class="attribute">match=</span><span class="value xpath">"*"</span> <span class="attribute">mode=</span><span class="value">"json"</span><span class="end">&gt;</span></span><span class="text"></content></line></span></span>
<line id="27"><marker></marker><content><span class="context-markup xml xsl"><span class="text">        </span><span class="tag open"><span class="begin">&lt;xsl:variable</span> <span class="attribute">name=</span><span class="value">"has-siblings"</span> <span class="attribute">select=</span><span class="value xpath">"name(.) = name(preceding-sibling::*) or name(.) = name(following-sibling::*)"</span> <span class="end">/&gt;</span></span><span class="text"></content></line></span></span>
<line id="28"><marker></marker><content><span class="context-markup xml xsl"><span class="text">        </span><span class="tag open"><span class="begin">&lt;xsl:variable</span> <span class="attribute">name=</span><span class="value">"has-children"</span> <span class="attribute">select=</span><span class="value xpath">"child::*"</span> <span class="end">/&gt;</span></span><span class="text"></content></line></span></span>
<line id="29"><marker></marker><content><span class="context-markup xml xsl"><span class="text">        </span><span class="tag open"><span class="begin">&lt;xsl:variable</span> <span class="attribute">name=</span><span class="value">"is-node"</span> <span class="attribute">select=</span><span class="value xpath">"$has-siblings and position() = 1 or not($has-siblings)"</span> <span class="end">/&gt;</span></span><span class="text"></content></line></span></span>
<line id="30"><marker></marker><content><span class="context-markup xml xsl"><span class="text"></content></line></span></span>
<line id="31"><marker></marker><content><span class="context-markup xml xsl"><span class="text">        </span><span class="tag open"><span class="begin">&lt;xsl:if</span> <span class="attribute">test=</span><span class="value xpath">"$is-node"</span><span class="end">&gt;</span></span><span class="text">"</span><span class="tag open"><span class="begin">&lt;xsl:value-of</span> <span class="attribute">select=</span><span class="value xpath">"name(.)"</span> <span class="end">/&gt;</span></span><span class="text">": </span><span class="tag close">&lt;/xsl:if&gt;</span><span class="text">    </span><span class="comment"><span class="start">&lt;!--</span> Name <span class="stop">--&gt;</span></span><span class="text"></content></line></span></span>
<line id="32"><marker></marker><content><span class="context-markup xml xsl"><span class="text">        </span><span class="tag open"><span class="begin">&lt;xsl:if</span> <span class="attribute">test=</span><span class="value xpath">"$has-siblings and position() = 1"</span><span class="end">&gt;</span></span><span class="text">[</span><span class="tag close">&lt;/xsl:if&gt;</span><span class="text">         </span><span class="comment"><span class="start">&lt;!--</span> Array <span class="stop">--&gt;</span></span><span class="text"></content></line></span></span>
<line id="33"><marker></marker><content><span class="context-markup xml xsl"><span class="text">        </span><span class="tag open"><span class="begin">&lt;xsl:if</span> <span class="attribute">test=</span><span class="value xpath">"$has-children"</span><span class="end">&gt;</span></span><span class="text">{</span><span class="tag close">&lt;/xsl:if&gt;</span><span class="text">                    </span><span class="comment"><span class="start">&lt;!--</span> Object <span class="stop">--&gt;</span></span><span class="text"></content></line></span></span>
<line id="34"><marker></marker><content><span class="context-markup xml xsl"><span class="text">        </span><span class="tag open"><span class="begin">&lt;xsl:apply-templates</span> <span class="attribute">select=</span><span class="value xpath">"* | text()"</span> <span class="attribute">mode=</span><span class="value">"json"</span><span class="end">/&gt;</span></span><span class="text">             </span><span class="comment"><span class="start">&lt;!--</span> Recursion <span class="stop">--&gt;</span></span><span class="text"></content></line></span></span>
<line id="35"><marker></marker><content><span class="context-markup xml xsl"><span class="text">        </span><span class="tag open"><span class="begin">&lt;xsl:if</span> <span class="attribute">test=</span><span class="value xpath">". = ''"</span><span class="end">&gt;</span></span><span class="text">null</span><span class="tag close">&lt;/xsl:if&gt;</span><span class="text">                     </span><span class="comment"><span class="start">&lt;!--</span> Empty Element <span class="stop">--&gt;</span></span><span class="text"></content></line></span></span>
<line id="36"><marker></marker><content><span class="context-markup xml xsl"><span class="text">        </span><span class="tag open"><span class="begin">&lt;xsl:if</span> <span class="attribute">test=</span><span class="value xpath">"$has-children"</span><span class="end">&gt;</span></span><span class="text">}</span><span class="tag close">&lt;/xsl:if&gt;</span><span class="text">                    </span><span class="comment"><span class="start">&lt;!--</span> /Object <span class="stop">--&gt;</span></span><span class="text"></content></line></span></span>
<line id="37"><marker></marker><content><span class="context-markup xml xsl"><span class="text">        </span><span class="tag open"><span class="begin">&lt;xsl:if</span> <span class="attribute">test=</span><span class="value xpath">"$has-siblings and position() = last()"</span><span class="end">&gt;</span></span><span class="text">]</span><span class="tag close">&lt;/xsl:if&gt;</span><span class="text">     </span><span class="comment"><span class="start">&lt;!--</span> /Array <span class="stop">--&gt;</span></span><span class="text"></content></line></span></span>
<line id="38"><marker></marker><content><span class="context-markup xml xsl"><span class="text">        </span><span class="tag open"><span class="begin">&lt;xsl:if</span> <span class="attribute">test=</span><span class="value xpath">"position() != last()"</span><span class="end">&gt;</span></span><span class="text">,</span><span class="tag close">&lt;/xsl:if&gt;</span><span class="text">                </span><span class="comment"><span class="start">&lt;!--</span> Separator <span class="stop">--&gt;</span></span><span class="text"></content></line></span></span>
<line id="39"><marker></marker><content><span class="context-markup xml xsl"><span class="text">    </span><span class="tag close">&lt;/xsl:template&gt;</span><span class="text"></content></line></span></span>
<line id="40"><marker></marker><content><span class="context-markup xml xsl"><span class="text"></content></line></span></span>
<line id="41"><marker></marker><content><span class="context-markup xml xsl"><span class="text">    </span><span class="tag open"><span class="begin">&lt;xsl:template</span> <span class="attribute">match=</span><span class="value xpath">"text()"</span> <span class="attribute">mode=</span><span class="value">"json"</span><span class="end">&gt;</span></span><span class="text"></content></line></span></span>
<line id="42"><marker></marker><content><span class="context-markup xml xsl"><span class="text">        </span><span class="tag open"><span class="begin">&lt;xsl:variable</span> <span class="attribute">name=</span><span class="value">"is-string"</span> <span class="attribute">select=</span><span class="value xpath">"string(number(.)) = 'NaN' and . != 'true' and . != 'false'"</span> <span class="end">/&gt;</span></span><span class="text"></content></line></span></span>
<line id="43"><marker></marker><content><span class="context-markup xml xsl"><span class="text"></content></line></span></span>
<line id="44"><marker></marker><content><span class="context-markup xml xsl"><span class="text">        </span><span class="tag open"><span class="begin">&lt;xsl:if</span> <span class="attribute">test=</span><span class="value xpath">"$is-string"</span><span class="end">&gt;</span></span><span class="text">"</span><span class="tag close">&lt;/xsl:if&gt;</span><span class="text"></content></line></span></span>
<line id="45"><marker></marker><content><span class="context-markup xml xsl"><span class="text">        </span><span class="tag open"><span class="begin">&lt;xsl:call-template</span> <span class="attribute">name=</span><span class="value">"string-replace"</span><span class="end">&gt;</span></span><span class="text">                </span><span class="comment"><span class="start">&lt;!--</span> Escape Quotes <span class="stop">--&gt;</span></span><span class="text"></content></line></span></span>
<line id="46"><marker></marker><content><span class="context-markup xml xsl"><span class="text">            </span><span class="tag open"><span class="begin">&lt;xsl:with-param</span> <span class="attribute">name=</span><span class="value">"haystack"</span> <span class="attribute">select=</span><span class="value xpath">"."</span> <span class="end">/&gt;</span></span><span class="text"></content></line></span></span>
<line id="47"><marker></marker><content><span class="context-markup xml xsl"><span class="text">            </span><span class="tag open"><span class="begin">&lt;xsl:with-param</span> <span class="attribute">name=</span><span class="value">"search"</span> <span class="attribute">select=</span><span class="value xpath">"'<span class="entity">&amp;#34;</span>'"</span> <span class="end">/&gt;</span></span><span class="text"></content></line></span></span>
<line id="48"><marker></marker><content><span class="context-markup xml xsl"><span class="text">            </span><span class="tag open"><span class="begin">&lt;xsl:with-param</span> <span class="attribute">name=</span><span class="value">"replace"</span> <span class="attribute">select=</span><span class="value xpath">"'<span class="entity">&amp;#92;</span><span class="entity">&amp;#34;</span>'"</span> <span class="end">/&gt;</span></span><span class="text"></content></line></span></span>
<line id="49"><marker></marker><content><span class="context-markup xml xsl"><span class="text">        </span><span class="tag close">&lt;/xsl:call-template&gt;</span><span class="text"></content></line></span></span>
<line id="50"><marker></marker><content><span class="context-markup xml xsl"><span class="text">        </span><span class="tag open"><span class="begin">&lt;xsl:if</span> <span class="attribute">test=</span><span class="value xpath">"$is-string"</span><span class="end">&gt;</span></span><span class="text">"</span><span class="tag close">&lt;/xsl:if&gt;</span><span class="text"></content></line></span></span>
<line id="51"><marker></marker><content><span class="context-markup xml xsl"><span class="text">    </span><span class="tag close">&lt;/xsl:template&gt;</span><span class="text"></content></line></span></span>
<line id="52"><marker></marker><content><span class="context-markup xml xsl"><span class="text"></content></line></span></span>
<line id="53"><marker></marker><content><span class="context-markup xml xsl"><span class="text"></span><span class="tag close">&lt;/xsl:stylesheet&gt;</span></span></content></line></pre>